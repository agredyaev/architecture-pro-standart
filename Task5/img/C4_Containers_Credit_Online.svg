<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1855px" preserveAspectRatio="none" style="width:959px;height:1855px;background:#FFFFFF;" version="1.1" viewBox="0 0 959 1855" width="959px" zoomAndPan="magnify"><defs/><g><rect height="26.2969" style="stroke:#00000000;stroke-width:1.0;fill:none;" width="622" x="161.715" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="612" x="166.715" y="22.9951">Диаграмма контейнеров (C4 Level 2) для онлайн-заявки на кредит (TO-BE)</text><!--MD5=[c18f891ed9e6e34f7069cfb5e52f3c85]
cluster bank_system--><g id="cluster_bank_system"><rect height="1643" rx="2.5" ry="2.5" style="stroke:#444444;stroke-width:1.0;fill:none;stroke-dasharray:7.0,7.0;" width="735" x="18.93" y="206.2969"/><text fill="#444444" font-family="sans-serif" font-size="6" font-style="italic" lengthAdjust="spacing" textLength="38" x="367.43" y="213.8662">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="258" x="257.43" y="233.1484">IT-система банка 'Стандарт'</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="62" x="355.43" y="248.0605">[System]</text></g><!--MD5=[b28aa581b368ee44b47058821a471cec]
cluster loan_app_service_boundary--><g id="cluster_loan_app_service_boundary"><rect height="185" rx="2.5" ry="2.5" style="stroke:#444444;stroke-width:1.0;fill:none;stroke-dasharray:7.0,7.0;" width="425" x="42.93" y="565.2969"/><text fill="#444444" font-family="sans-serif" font-size="6" font-style="italic" lengthAdjust="spacing" textLength="38" x="236.43" y="572.8662">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="235" x="137.93" y="592.1484">Сервис Заявок на Кредит</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="215.43" y="607.0605">[Container]</text></g><!--MD5=[0779245680d4c0ece82c632b3c1154cb]
cluster preapproved_offer_service_boundary--><g id="cluster_preapproved_offer_service_boundary"><rect height="185" rx="2.5" ry="2.5" style="stroke:#444444;stroke-width:1.0;fill:none;stroke-dasharray:7.0,7.0;" width="422" x="307.93" y="999.2969"/><text fill="#444444" font-family="sans-serif" font-size="6" font-style="italic" lengthAdjust="spacing" textLength="38" x="499.93" y="1006.8662">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="370" x="333.93" y="1026.1484">Сервис Предодобренных Предложений</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="478.93" y="1041.0605">[Container]</text></g><!--MD5=[e42808fd03dc2cbc15b170499c01bf6c]
cluster abs_boundary--><g id="cluster_abs_boundary"><rect height="410" rx="2.5" ry="2.5" style="stroke:#444444;stroke-width:1.0;fill:none;stroke-dasharray:7.0,7.0;" width="228" x="168.93" y="1415.2969"/><text fill="#444444" font-family="sans-serif" font-size="6" font-style="italic" lengthAdjust="spacing" textLength="38" x="263.93" y="1422.8662">«boundary»</text><text fill="#444444" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="36" x="264.93" y="1442.1484">АБС</text><text fill="#444444" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="80" x="242.93" y="1457.0605">[Container]</text></g><!--MD5=[e9053c6dbb891ad4199c45de881c9d13]
entity website--><g id="elem_website"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="110" x="280.93" y="267.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="298.93" y="288.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="42" x="314.93" y="306.1172">Сайт</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="90" x="290.93" y="321.0293">[PHP, React.js]</text></g><!--MD5=[21503ba018392213cfe7071482b8b579]
entity ib--><g id="elem_ib"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="164" x="439.93" y="267.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="484.93" y="288.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="136" x="453.93" y="306.1172">Интернет-банк</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="144" x="449.93" y="321.0293">[ASP.NET MVC, MS SQL]</text></g><!--MD5=[76642c686924d2234c32dd0968779847]
entity api_gateway--><g id="elem_api_gateway"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="168" x="371.93" y="423.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="418.93" y="444.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="113" x="399.43" y="462.1172">API Gateway</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="148" x="381.93" y="477.0293">[Spring Cloud Gateway]</text></g><!--MD5=[1729cd35d55f98b869577ea5b63d9f84]
entity idp--><g id="elem_idp"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="170" x="565.93" y="646.7969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="613.93" y="667.9355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="150" x="575.93" y="685.6172">Identity Provider</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="66" x="617.93" y="700.5293">[Keycloak]</text></g><!--MD5=[e29745d789d1cd237fb5892a53e7b9d1]
entity kafka--><g id="elem_kafka"><rect fill="#438DD5" height="85.1875" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="204" x="237.93" y="825.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="302.93" y="846.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="178" x="247.93" y="864.1172">Брокер сообщений</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="49" x="315.43" y="882.7422">Kafka</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="96" x="291.93" y="897.6543">[Apache Kafka]</text></g><!--MD5=[40519292f206c703afba4d0acdc26984]
entity schema_registry--><g id="elem_schema_registry"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="198" x="41.93" y="267.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="103.93" y="288.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="149" x="66.43" y="306.1172">Schema Registry</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="178" x="51.93" y="321.0293">[Confluent Schema Registry]</text></g><!--MD5=[4097cc846b9f8bbd03673bd67e849fe8]
entity credit_conveyor--><g id="elem_credit_conveyor"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="217" x="72.43" y="1080.7969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="143.93" y="1101.9355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="197" x="82.43" y="1119.6172">Кредитный конвейер</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="103" x="129.43" y="1134.5293">[Java, Camunda]</text></g><!--MD5=[7457b98c7b43e58e9d2921d4443e1b37]
entity scoring_system--><g id="elem_scoring_system"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="185" x="190.43" y="1259.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="245.93" y="1280.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="165" x="200.43" y="1298.1172">Система скоринга</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="92" x="236.93" y="1313.0293">[Python, Flask]</text></g><!--MD5=[31e2a8a223fc8fefe6b3064cb838ce51]
entity loan_app_service_api--><g id="elem_loan_app_service_api"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="137" x="314.43" y="646.7969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="345.93" y="667.9355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="30" x="367.93" y="685.6172">API</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="117" x="324.43" y="700.5293">[Java, Spring Boot]</text></g><!--MD5=[2365d616fb3aa1bafb918f9b14cb14fd]
entity loan_app_service_db--><g id="elem_loan_app_service_db"><path d="M58.93,636.2969 C58.93,626.2969 168.93,626.2969 168.93,626.2969 C168.93,626.2969 278.93,626.2969 278.93,636.2969 L278.93,724.4531 C278.93,734.4531 168.93,734.4531 168.93,734.4531 C168.93,734.4531 58.93,734.4531 58.93,724.4531 L58.93,636.2969 " fill="#438DD5" style="stroke:#3C7FC0;stroke-width:0.5;"/><path d="M58.93,636.2969 C58.93,646.2969 168.93,646.2969 168.93,646.2969 C168.93,646.2969 278.93,646.2969 278.93,636.2969 " fill="none" style="stroke:#3C7FC0;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="131.93" y="661.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="25" x="156.43" y="679.1172">DB</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="80" x="128.93" y="694.0293">[PostgreSQL]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="166.93" y="709.8545"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="196" x="72.93" y="726.1514">Хранилище онлайн-заявок</text></g><!--MD5=[355a3a3113d60f90161ee41b8530ace0]
entity preapproved_offer_service_api--><g id="elem_preapproved_offer_service_api"><rect fill="#438DD5" height="66.5625" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="137" x="576.43" y="1080.7969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="607.93" y="1101.9355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="30" x="629.93" y="1119.6172">API</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="117" x="586.43" y="1134.5293">[Java, Spring Boot]</text></g><!--MD5=[624d4703da9c560e79e5e793305273b8]
entity preapproved_offer_service_db--><g id="elem_preapproved_offer_service_db"><path d="M324.43,1070.2969 C324.43,1060.2969 432.93,1060.2969 432.93,1060.2969 C432.93,1060.2969 541.43,1060.2969 541.43,1070.2969 L541.43,1158.4531 C541.43,1168.4531 432.93,1168.4531 432.93,1168.4531 C432.93,1168.4531 324.43,1168.4531 324.43,1158.4531 L324.43,1070.2969 " fill="#438DD5" style="stroke:#3C7FC0;stroke-width:0.5;"/><path d="M324.43,1070.2969 C324.43,1080.2969 432.93,1080.2969 432.93,1080.2969 C432.93,1080.2969 541.43,1080.2969 541.43,1070.2969 " fill="none" style="stroke:#3C7FC0;stroke-width:0.5;"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="395.93" y="1095.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="25" x="420.43" y="1113.1172">DB</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="80" x="392.93" y="1128.0293">[PostgreSQL]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="430.93" y="1143.8545"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193" x="338.43" y="1160.1514">Хранилище предложений</text></g><!--MD5=[e3abd2a50ce2a0b0990e97a0b13f805f]
entity abs_api--><g id="elem_abs_api"><rect fill="#438DD5" height="115.4531" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="196" x="184.93" y="1476.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="245.93" y="1497.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="71" x="247.43" y="1515.1172">ABS API</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="117" x="224.43" y="1530.0293">[Java, Spring Boot]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="280.93" y="1545.8545"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="168" x="198.93" y="1562.1514">API-слой для доступа к</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="268.43" y="1578.4482">АБС</text></g><!--MD5=[edd49d60ef8d96d160eeb3fd4ec6464c]
entity abs_app--><g id="elem_abs_app"><rect fill="#438DD5" height="115.4531" rx="2.5" ry="2.5" style="stroke:#3C7FC0;stroke-width:0.5;" width="180" x="184.93" y="1694.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="74" x="237.93" y="1715.4355">«container»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="160" x="194.93" y="1733.1172">Приложение АБС</text><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="98" x="225.93" y="1748.0293">[Delphi, PL/SQL]</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="4" x="272.93" y="1763.8545"> </text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="132" x="208.93" y="1780.1514">Основная учетная</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61" x="244.43" y="1796.4482">система</text></g><!--MD5=[4a65e84059005d12693a083370a06717]
entity client--><g id="elem_client"><rect fill="#08427B" height="100.5938" rx="2.5" ry="2.5" style="stroke:#073B6F;stroke-width:0.5;" width="87" x="478.43" y="44.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="57" x="493.43" y="65.4355">«person»</text><image height="48" width="48" x="497.93" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAIAAADYYG7QAAABuUlEQVR42u2Yv0oEMRDGp/QRfIR7BVs7Gx9AH0CwtrtKLNXSRsRSG8HCxkbQVrSykoOrzlILC9v4gwMRNptMMsnu3nHDFMcSLh/f/PsmsrY5HpTLUgHaOri8uHt+eJm8vs/wm8e38fn9aPekB0D7p7df3z+uxYC4sXfWEaD17SPIcAqDreqAQBMgpmnHV091ASm5+W8EtxYgQuCyDF7LA+JPXa5RieUBwbwzWHlAVLIFEB2rMKCk4rK0AC0gZzN9/S8soOnHpwWQvhtpATE4h5XUlrKnIKp06uxCS5poCzs6stvjzuF1XfmRVG4ZkihHMSp5SuXGJGG5LEAVPSIpb4qJfIQzQeF6OMORGXSHbCjLuAb1CYhti7whQHQ5PLrlcHh+kiAyN/RxFE0/9OYvH+dJw33gw/nB4bYa5Ltmokl4MTXqMi+sMFtSfFBEDWoD67bUkPSa+d/Gk3i7i6tvxE4LyLhgGOeu9ELPXzLFAVHJrkNrZreUFfN28S9l1x27upVSLwp5hlIYFqBm8a8ADRxQJIfszy72ZxrpeKxGR6xnltEbupkbXtkpbQsh6ozhV8kDCni1dcT8F2bsoAKLcdt7AAAAAElFTkSuQmCC" y="68.2656"/><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="67" x="488.43" y="131.1172">Клиент</text></g><!--MD5=[827bd56949eabd395be8ee6788daf7d6]
entity bki--><g id="elem_bki"><rect fill="#999999" height="71.2188" rx="2.5" ry="2.5" style="stroke:#8A8A8A;stroke-width:0.5;" width="183" x="770.43" y="1498.2969"/><text fill="#FFFFFF" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="115" x="804.43" y="1519.4355">«external_system»</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="157" x="780.43" y="1537.1172">Бюро кредитных</text><text fill="#FFFFFF" font-family="sans-serif" font-size="16" font-weight="bold" lengthAdjust="spacing" textLength="74" x="824.93" y="1555.7422">историй</text></g><!--MD5=[04419be90f377af61d86b6cb1aac130b]
link client to idp--><g id="link_client_idp"><path d="M565.51,114.5769 C590.82,127.8169 620.96,148.0469 637.93,175.2969 C726.58,317.6569 711.11,383.2069 687.93,549.2969 C683.64,580.0469 673.9,613.7369 665.49,639.1169 " fill="none" id="client-to-idp" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="662.93,646.7069,668.3283,640.0843,662.6427,638.1677,662.93,646.7069" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="141" x="705.93" y="376.4355">Аутентифицируется</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="88" x="732.43" y="390.4043">[OAuth2/OIDC]</text></g><!--MD5=[652b3251b8fc68bc50f2086d74a076cd]
link api_gateway to idp--><g id="link_api_gateway_idp"><path d="M499.95,490.3769 C511.2,499.5269 522.93,509.8469 532.93,520.2969 C568.78,557.7369 603.33,606.2269 625.68,639.7669 " fill="none" id="api_gateway-to-idp" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="630.26,646.6869,628.3474,638.3597,623.3436,641.6706,630.26,646.6869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="116" x="558.93" y="532.4355">Валидирует JWT</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="41" x="598.43" y="546.4043">токен</text></g><!--MD5=[84b990784b6c83f679c6449834d4e27d]
link client to website--><g id="link_client_website"><path d="M478.36,119.0869 C454.9,133.1469 426.61,152.6969 405.93,175.2969 C383.15,200.1869 364.81,233.7969 352.63,259.8169 " fill="none" id="client-to-website" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="349.2,267.2869,355.2576,261.2615,349.802,258.7641,349.2,267.2869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="106" x="406.93" y="187.4355">Подает заявку</text></g><!--MD5=[877557de86b601de155bcfc3766dc40a]
link client to ib--><g id="link_client_ib"><path d="M521.93,145.4369 C521.93,180.3369 521.93,226.4569 521.93,259.1769 " fill="none" id="client-to-ib" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="521.93,267.1869,524.93,259.1869,518.93,259.1869,521.93,267.1869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="106" x="522.93" y="187.4355">Подает заявку</text></g><!--MD5=[a20f2237a990a845cc8c35dd64e4ddbc]
link website to api_gateway--><g id="link_website_api_gateway"><path d="M280.89,323.2969 C252.37,335.6769 221.87,351.2969 213.93,364.2969 C207.21,375.2969 206.04,383.1069 213.93,393.2969 C232.56,417.3469 303.37,433.7969 363.62,443.7669 " fill="none" id="website-to-api_gateway" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="371.66,445.0669,364.2383,440.8338,363.285,446.7576,371.66,445.0669" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="144" x="214.93" y="376.4355">Отправляет данные</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="48" x="264.93" y="390.4043">заявки</text></g><!--MD5=[6a466af2888ab1e406aeb855a8127dd3]
link ib to api_gateway--><g id="link_ib_api_gateway"><path d="M511.41,334.4169 C505.4,352.0769 497.39,374.1469 488.93,393.2969 C485.66,400.7069 481.88,408.4469 478.07,415.8569 " fill="none" id="ib-to-api_gateway" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="474.28,423.1369,480.6375,417.4288,475.3167,414.656,474.28,423.1369" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="144" x="500.93" y="376.4355">Отправляет данные</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="48" x="550.93" y="390.4043">заявки</text></g><!--MD5=[6a466af2888ab1e406aeb855a8127dd3]
link ib to api_gateway--><g id="link_ib_api_gateway"><path d="M439.76,318.7569 C415.4,328.0269 391.39,342.3169 376.93,364.2969 C364.6,383.0469 376.34,402.0869 394.21,417.9169 " fill="none" id="ib-to-api_gateway-1" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="400.48,423.1569,396.2717,415.7211,392.4201,420.3217,400.48,423.1569" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="98" x="377.93" y="376.4355">Запрашивает</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="99" x="379.43" y="390.4043">предложения</text></g><!--MD5=[299d09405378c10c212d64912cb5ff11]
link api_gateway to loan_app_service_api--><g id="link_api_gateway_loan_app_service_api"><path d="M404.17,490.4269 C394.76,498.9269 386.25,508.9369 380.93,520.2969 C363.55,557.4069 367,604.9269 372.96,638.3169 " fill="none" id="api_gateway-to-loan_app_service_api" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="374.52,646.4869,375.9666,638.0662,370.073,639.1914,374.52,646.4869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="137" x="381.93" y="539.4355">Проксирует запрос</text></g><!--MD5=[d9aefc0b9287192416341861a66aa88a]
link loan_app_service_api to scoring_system--><g id="link_loan_app_service_api_scoring_system"><path d="M346.12,713.9069 C330.63,727.6269 312.41,743.7369 295.93,758.2969 C184.27,856.9269 111.74,853.5669 54.93,991.2969 C20.87,1073.8769 6,1117.5569 54.93,1192.2969 C83.33,1235.6769 135.25,1260.2569 182.37,1274.1269 " fill="none" id="loan_app_service_api-to-scoring_system" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="190.19,1276.3469,183.3133,1271.2763,181.6748,1277.0483,190.19,1276.3469" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="149" x="80.93" y="952.4355">Синхронно вызывает</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="135" x="87.93" y="966.4043">для предв. оценки</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="102" x="104.43" y="980.373">[Circuit Breaker]</text></g><!--MD5=[096faa570e1c2b94d7a1bb08adab2d08]
link scoring_system to bki--><g id="link_scoring_system_bki"><path d="M361.92,1326.4069 C468.55,1370.4169 658.13,1448.6769 770.71,1495.1469 " fill="none" id="scoring_system-to-bki" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="778.35,1498.2969,772.096,1492.4756,769.8104,1498.0232,778.35,1498.2969" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="98" x="558.43" y="1375.4355">Запрашивает</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="143" x="537.93" y="1389.4043">кредитную историю</text></g><!--MD5=[9f79ceb92be5fa5dd73f19980bdcb38a]
link loan_app_service_api to kafka--><g id="link_loan_app_service_api_kafka"><path d="M375.34,714.0369 C368.72,742.6069 359.01,784.4969 351.43,817.1869 " fill="none" id="loan_app_service_api-to-kafka" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="349.55,825.2869,354.272,818.1663,348.4257,816.8172,349.55,825.2869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="75" x="384.43" y="778.4355">Публикует</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="120" x="363.93" y="792.4043">'ЗаявкаСоздана'</text></g><!--MD5=[3a6e92df644a98e768c847bce27081ad]
link kafka to credit_conveyor--><g id="link_kafka_credit_conveyor"><path d="M312.78,910.5469 C283.06,956.2469 235.77,1028.9669 206.63,1073.7669 " fill="none" id="kafka-to-credit_conveyor" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="202.12,1080.7169,208.999,1075.6494,203.9708,1072.3757,202.12,1080.7169" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="69" x="318.43" y="959.4355">Получает</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="120" x="294.93" y="973.4043">'ЗаявкаСоздана'</text></g><!--MD5=[b66c711b449870653884bc57448273f0]
link credit_conveyor to scoring_system--><g id="link_credit_conveyor_scoring_system"><path d="M199.88,1148.0769 C216.84,1177.4269 241.75,1220.5469 259.87,1251.8869 " fill="none" id="credit_conveyor-to-scoring_system" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="264.09,1259.1869,262.6752,1250.7608,257.4837,1253.7687,264.09,1259.1869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="98" x="250.93" y="1212.4355">Запрашивает</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="112" x="245.93" y="1226.4043">полный скоринг</text></g><!--MD5=[0b5cd5614ada93151a0d33f3cf47bb98]
link scoring_system to abs_api--><g id="link_scoring_system_abs_api"><path d="M282.93,1326.5269 C282.93,1362.8269 282.93,1422.3069 282.93,1468.0869 " fill="none" id="scoring_system-to-abs_api" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="282.93,1476.1869,285.93,1468.1869,279.93,1468.1869,282.93,1476.1869" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="134" x="283.93" y="1368.4355">Запрашивает доп.</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="55" x="325.43" y="1382.4043">данные</text><text fill="#666666" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="43" x="331.43" y="1396.373">[mTLS]</text></g><!--MD5=[77e803d1dee4041110e07a284249fe7b]
link abs_api to abs_app--><g id="link_abs_api_abs_app"><path d="M280.83,1591.5469 C279.76,1620.4569 278.45,1655.7369 277.34,1685.7369 " fill="none" id="abs_api-to-abs_app" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="277.03,1694.0469,280.3277,1686.1649,274.3319,1685.9401,277.03,1694.0469" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="143" x="280.93" y="1633.4355">Выполняет запрос к</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="66" x="304.93" y="1647.4043">ядру АБС</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="25" x="374.93" y="1647.4043">' &lt;--</text><text fill="#666666" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85" x="311.93" y="1661.373">ИСПРАВЛЕНО</text></g><!--MD5=[f9e5470a8a307a8f5a9589d95304b7bc]
link api_gateway to preapproved_offer_service_api--><g id="link_api_gateway_preapproved_offer_service_api"><path d="M501.04,490.5569 C510.02,499.2169 518.38,509.2669 523.93,520.2969 C547.83,567.8069 539.18,706.0169 548.93,758.2969 C570.53,874.0969 610.86,1007.3769 631.7,1072.7869 " fill="none" id="api_gateway-to-preapproved_offer_service_api" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="634.14,1080.4269,634.5527,1071.8928,628.8395,1073.7258,634.14,1080.4269" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="137" x="555.93" y="785.4355">Проксирует запрос</text></g><!--MD5=[aa716f685d390689f52158b132d53913]
link preapproved_offer_service_api to scoring_system--><g id="link_preapproved_offer_service_api_scoring_system"><path d="M614.21,1148.1169 C598.76,1163.1669 579.06,1180.2769 558.93,1192.2969 C504.53,1224.7669 437.84,1249.1769 383.64,1265.6869 " fill="none" id="preapproved_offer_service_api-to-scoring_system" style="stroke:#666666;stroke-width:1.0;"/><polygon fill="#666666" points="375.74,1268.0669,384.2649,1268.6387,382.5388,1262.8923,375.74,1268.0669" style="stroke:#666666;stroke-width:1.0;"/><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="146" x="538.93" y="1212.4355">Запускает пакетный</text><text fill="#666666" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="55" x="586.43" y="1226.4043">скоринг</text></g><!--MD5=[6b49161f9a80288ab03102227a216ac0]
@startuml
!include <C4/C4_Container>

title Диаграмма контейнеров (C4 Level 2) для онлайн-заявки на кредит (TO-BE)

' - - - Пользователи - - -
Person(client, "Клиент")

' - - - Внешние системы - - -
System_Ext(bki, "Бюро кредитных историй")

' - - - Граница основной системы - - -
System_Boundary(bank_system, "IT-система банка 'Стандарт'") {
    Container(website, "Сайт", "PHP, React.js")
    Container(ib, "Интернет-банк", "ASP.NET MVC, MS SQL")

    Container(api_gateway, "API Gateway", "Spring Cloud Gateway")
    Container(idp, "Identity Provider", "Keycloak")
    
    Container_Boundary(loan_app_service_boundary, "Сервис Заявок на Кредит") {
        Container(loan_app_service_api, "API", "Java, Spring Boot")
        ContainerDb(loan_app_service_db, "DB", "PostgreSQL", "Хранилище онлайн-заявок")
    }

    Container_Boundary(preapproved_offer_service_boundary, "Сервис Предодобренных Предложений") {
        Container(preapproved_offer_service_api, "API", "Java, Spring Boot")
        ContainerDb(preapproved_offer_service_db, "DB", "PostgreSQL", "Хранилище предложений")
    }
    
    Container(kafka, "Брокер сообщений Kafka", "Apache Kafka")
    Container(schema_registry, "Schema Registry", "Confluent Schema Registry")

    Container(credit_conveyor, "Кредитный конвейер", "Java, Camunda")
    Container(scoring_system, "Система скоринга", "Python, Flask")
    
    Container_Boundary(abs_boundary, "АБС") {
        Container(abs_api, "ABS API", "Java, Spring Boot", "API-слой для доступа к АБС")
        Container(abs_app, "Приложение АБС", "Delphi, PL/SQL", "Основная учетная система")
    }
}

' - - - Связи - - -

' 1. Аутентификация
Rel(client, idp, "Аутентифицируется", "OAuth2/OIDC")
Rel(api_gateway, idp, "Валидирует JWT токен")

' 2. Подача заявки (синхронная часть)
Rel(client, website, "Подает заявку")
Rel(client, ib, "Подает заявку")
Rel(website, api_gateway, "Отправляет данные заявки")
Rel(ib, api_gateway, "Отправляет данные заявки")
Rel(api_gateway, loan_app_service_api, "Проксирует запрос")
Rel(loan_app_service_api, scoring_system, "Синхронно вызывает для предв. оценки", "Circuit Breaker")
Rel(scoring_system, bki, "Запрашивает кредитную историю")

' 3. Асинхронная обработка
Rel(loan_app_service_api, kafka, "Публикует 'ЗаявкаСоздана'")
Rel(kafka, credit_conveyor, "Получает 'ЗаявкаСоздана'")

' 4. Процесс в КК
Rel(credit_conveyor, scoring_system, "Запрашивает полный скоринг")
Rel(scoring_system, abs_api, "Запрашивает доп. данные", "mTLS")
Rel(abs_api, abs_app, "Выполняет запрос к ядру АБС") ' <- - ИСПРАВЛЕНО

' 5. Предодобренные предложения
Rel(ib, api_gateway, "Запрашивает предложения")
Rel(api_gateway, preapproved_offer_service_api, "Проксирует запрос")
Rel(preapproved_offer_service_api, scoring_system, "Запускает пакетный скоринг")

@enduml

@startuml














skinparam defaultTextAlignment center

skinparam wrapWidth 200
skinparam maxMessageSize 150

skinparam LegendBorderColor transparent
skinparam LegendBackgroundColor transparent
skinparam LegendFontColor #FFFFFF

skinparam shadowing<<legendArea>> false
skinparam rectangle<<legendArea>> {
    backgroundcolor #00000000
    bordercolor #00000000
}

skinparam rectangle {
    StereotypeFontSize 12
    shadowing false
}

skinparam database {
    StereotypeFontSize 12
    shadowing false
}

skinparam queue {
    StereotypeFontSize 12
    shadowing false
}

skinparam arrow {
    Color #666666
    FontColor #666666
    FontSize 12
}

skinparam actor {
    StereotypeFontSize 12
    shadowing false
    style awesome
}

skinparam person {
    StereotypeFontSize 12
    shadowing false
}

skinparam package {
    StereotypeFontSize 6
    StereotypeFontColor transparent
    FontStyle plain
    BackgroundColor transparent
}

skinparam rectangle<<boundary>> {
    Shadowing false
    StereotypeFontSize 6
    StereotypeFontColor transparent
    FontColor #444444
    BorderColor #444444
    BackgroundColor transparent
    BorderStyle dashed
}





































































































skinparam rectangle<<person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #08427B
    BorderColor #073B6F
}
skinparam database<<person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #08427B
    BorderColor #073B6F
}
skinparam queue<<person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #08427B
    BorderColor #073B6F
}
skinparam actor<<person>> {
    StereotypeFontColor #08427B
    FontColor #08427B
    BackgroundColor #08427B
    BorderColor #073B6F
}
skinparam person<<person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #08427B
    BorderColor #073B6F
}


skinparam rectangle<<external_person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #686868
    BorderColor #8A8A8A
}
skinparam database<<external_person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #686868
    BorderColor #8A8A8A
}
skinparam queue<<external_person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #686868
    BorderColor #8A8A8A
}
skinparam actor<<external_person>> {
    StereotypeFontColor #686868
    FontColor #686868
    BackgroundColor #686868
    BorderColor #8A8A8A
}
skinparam person<<external_person>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #686868
    BorderColor #8A8A8A
}


skinparam rectangle<<system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #1168BD
    BorderColor #3C7FC0
}
skinparam database<<system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #1168BD
    BorderColor #3C7FC0
}
skinparam queue<<system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #1168BD
    BorderColor #3C7FC0
}
skinparam actor<<system>> {
    StereotypeFontColor #1168BD
    FontColor #1168BD
    BackgroundColor #1168BD
    BorderColor #3C7FC0
}
skinparam person<<system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #1168BD
    BorderColor #3C7FC0
}


skinparam rectangle<<external_system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #999999
    BorderColor #8A8A8A
}
skinparam database<<external_system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #999999
    BorderColor #8A8A8A
}
skinparam queue<<external_system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #999999
    BorderColor #8A8A8A
}
skinparam actor<<external_system>> {
    StereotypeFontColor #999999
    FontColor #999999
    BackgroundColor #999999
    BorderColor #8A8A8A
}
skinparam person<<external_system>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #999999
    BorderColor #8A8A8A
}





sprite $person [48x48/16] {
000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000
0000000000000000000049BCCA7200000000000000000000
0000000000000000006EFFFFFFFFB3000000000000000000
00000000000000001CFFFFFFFFFFFF700000000000000000
0000000000000001EFFFFFFFFFFFFFF80000000000000000
000000000000000CFFFFFFFFFFFFFFFF6000000000000000
000000000000007FFFFFFFFFFFFFFFFFF100000000000000
00000000000001FFFFFFFFFFFFFFFFFFF900000000000000
00000000000006FFFFFFFFFFFFFFFFFFFF00000000000000
0000000000000BFFFFFFFFFFFFFFFFFFFF40000000000000
0000000000000EFFFFFFFFFFFFFFFFFFFF70000000000000
0000000000000FFFFFFFFFFFFFFFFFFFFF80000000000000
0000000000000FFFFFFFFFFFFFFFFFFFFF80000000000000
0000000000000DFFFFFFFFFFFFFFFFFFFF60000000000000
0000000000000AFFFFFFFFFFFFFFFFFFFF40000000000000
00000000000006FFFFFFFFFFFFFFFFFFFE00000000000000
00000000000000EFFFFFFFFFFFFFFFFFF800000000000000
000000000000007FFFFFFFFFFFFFFFFFF100000000000000
000000000000000BFFFFFFFFFFFFFFFF5000000000000000
0000000000000001DFFFFFFFFFFFFFF70000000000000000
00000000000000000BFFFFFFFFFFFF500000000000000000
0000000000000000005DFFFFFFFFA1000000000000000000
0000000000000000000037ABB96100000000000000000000
000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000
000000000000025788300000000005886410000000000000
000000000007DFFFFFFD9643347BFFFFFFFB400000000000
0000000004EFFFFFFFFFFFFFFFFFFFFFFFFFFB1000000000
000000007FFFFFFFFFFFFFFFFFFFFFFFFFFFFFD200000000
00000006FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE10000000
0000003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB0000000
000000BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5000000
000003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD000000
000009FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF200000
00000DFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF600000
00000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF800000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
00001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA00000
00000EFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF700000
000006FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE100000
0000008FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD3000000
000000014555555555555555555555555555555300000000
000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000
}

sprite $person2 [48x48/16] {
0000000000000000000049BCCA7200000000000000000000
0000000000000000006EFFFFFFFFB3000000000000000000
00000000000000001CFFFFFFFFFFFF700000000000000000
0000000000000001EFFFFFFFFFFFFFF80000000000000000
000000000000000CFFFFFFFFFFFFFFFF6000000000000000
000000000000007FFFFFFFFFFFFFFFFFF100000000000000
00000000000001FFFFFFFFFFFFFFFFFFF900000000000000
00000000000006FFFFFFFFFFFFFFFFFFFF00000000000000
0000000000000BFFFFFFFFFFFFFFFFFFFF40000000000000
0000000000000EFFFFFFFFFFFFFFFFFFFF70000000000000
0000000000000FFFFFFFFFFFFFFFFFFFFF80000000000000
0000000000000FFFFFFFFFFFFFFFFFFFFF80000000000000
0000000000000DFFFFFFFFFFFFFFFFFFFF60000000000000
0000000000000AFFFFFFFFFFFFFFFFFFFF40000000000000
00000000000006FFFFFFFFFFFFFFFFFFFE00000000000000
00000000000000EFFFFFFFFFFFFFFFFFF800000000000000
000000000000007FFFFFFFFFFFFFFFFFF100000000000000
000000000000000BFFFFFFFFFFFFFFFF5000000000000000
0000000000000001DFFFFFFFFFFFFFF70000000000000000
00000000000000000BFFFFFFFFFFFF500000000000000000
0000000000000000005DFFFFFFFFA1000000000000000000
0000000000000000000037ABB96100000000000000000000
000000000002578888300000000005888864100000000000
0000000007DFFFFFFFFD9643347BFFFFFFFFFB4000000000
00000004EFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB10000000
0000007FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD2000000
000006FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFE100000
00003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB00000
0000BFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF50000
0003FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFD0000
0009FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF2000
000DFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF6000
000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8000
001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB000
001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB000
001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFB000
001FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA000
000FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF8000
000DFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF6000
0009FFFFFFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFFFFFF2000
0003FFFFFFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFFFFFD0000
0000BFFFFFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFFFFF50000
00003FFFFFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFFFFB00000
000006FFFFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFFFE100000
0000007FFFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFFD2000000
00000004EFFF8FFFFFFFFFFFFFFFFFFFFFF8FFFB10000000
0000000007DF8FFFFFFFFFFFFFFFFFFFFFF8FB4000000000
000000000002578888888888888888888864100000000000
}


























skinparam rectangle<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}
skinparam database<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}
skinparam queue<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}
skinparam actor<<container>> {
    StereotypeFontColor #438DD5
    FontColor #438DD5
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}
skinparam person<<container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #438DD5
    BorderColor #3C7FC0
}


skinparam rectangle<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}
skinparam database<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}
skinparam queue<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}
skinparam actor<<external_container>> {
    StereotypeFontColor #B3B3B3
    FontColor #B3B3B3
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}
skinparam person<<external_container>> {
    StereotypeFontColor #FFFFFF
    FontColor #FFFFFF
    BackgroundColor #B3B3B3
    BorderColor #A6A6A6
}

















title Диаграмма контейнеров (C4 Level 2) для онлайн-заявки на кредит (TO-BE)

rectangle "<$person>\n==Клиент" <<person>> as client 

rectangle "==Бюро кредитных историй" <<external_system>> as bki 

rectangle "==IT-система банка 'Стандарт'\n<size:12>[System]</size>" <<boundary>> as bank_system  {
    rectangle "==Сайт\n//<size:12>[PHP, React.js]</size>//" <<container>> as website 
    rectangle "==Интернет-банк\n//<size:12>[ASP.NET MVC, MS SQL]</size>//" <<container>> as ib 

    rectangle "==API Gateway\n//<size:12>[Spring Cloud Gateway]</size>//" <<container>> as api_gateway 
    rectangle "==Identity Provider\n//<size:12>[Keycloak]</size>//" <<container>> as idp 
    
rectangle "==Сервис Заявок на Кредит\n<size:12>[Container]</size>" <<boundary>> as loan_app_service_boundary  {
        rectangle "==API\n//<size:12>[Java, Spring Boot]</size>//" <<container>> as loan_app_service_api 
        database "==DB\n//<size:12>[PostgreSQL]</size>//\n\n Хранилище онлайн-заявок" <<container>> as loan_app_service_db 
    }

rectangle "==Сервис Предодобренных Предложений\n<size:12>[Container]</size>" <<boundary>> as preapproved_offer_service_boundary  {
        rectangle "==API\n//<size:12>[Java, Spring Boot]</size>//" <<container>> as preapproved_offer_service_api 
        database "==DB\n//<size:12>[PostgreSQL]</size>//\n\n Хранилище предложений" <<container>> as preapproved_offer_service_db 
    }
    
    rectangle "==Брокер сообщений Kafka\n//<size:12>[Apache Kafka]</size>//" <<container>> as kafka 
    rectangle "==Schema Registry\n//<size:12>[Confluent Schema Registry]</size>//" <<container>> as schema_registry 

    rectangle "==Кредитный конвейер\n//<size:12>[Java, Camunda]</size>//" <<container>> as credit_conveyor 
    rectangle "==Система скоринга\n//<size:12>[Python, Flask]</size>//" <<container>> as scoring_system 
    
rectangle "==АБС\n<size:12>[Container]</size>" <<boundary>> as abs_boundary  {
        rectangle "==ABS API\n//<size:12>[Java, Spring Boot]</size>//\n\n API-слой для доступа к АБС" <<container>> as abs_api 
        rectangle "==Приложение АБС\n//<size:12>[Delphi, PL/SQL]</size>//\n\n Основная учетная система" <<container>> as abs_app 
    }
}


client - ->> idp : **Аутентифицируется**\n//<size:12>[OAuth2/OIDC]</size>//
api_gateway - ->> idp : **Валидирует JWT токен**

client - ->> website : **Подает заявку**
client - ->> ib : **Подает заявку**
website - ->> api_gateway : **Отправляет данные заявки**
ib - ->> api_gateway : **Отправляет данные заявки**
api_gateway - ->> loan_app_service_api : **Проксирует запрос**
loan_app_service_api - ->> scoring_system : **Синхронно вызывает для предв. оценки**\n//<size:12>[Circuit Breaker]</size>//
scoring_system - ->> bki : **Запрашивает кредитную историю**

loan_app_service_api - ->> kafka : **Публикует 'ЗаявкаСоздана'**
kafka - ->> credit_conveyor : **Получает 'ЗаявкаСоздана'**

credit_conveyor - ->> scoring_system : **Запрашивает полный скоринг**
scoring_system - ->> abs_api : **Запрашивает доп. данные**\n//<size:12>[mTLS]</size>//
abs_api - ->> abs_app : **Выполняет запрос к ядру АБС** ' <- - ИСПРАВЛЕНО

ib - ->> api_gateway : **Запрашивает предложения**
api_gateway - ->> preapproved_offer_service_api : **Проксирует запрос**
preapproved_offer_service_api - ->> scoring_system : **Запускает пакетный скоринг**

@enduml

PlantUML version 1.2022.6(Tue Jun 21 17:34:49 GMT 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>